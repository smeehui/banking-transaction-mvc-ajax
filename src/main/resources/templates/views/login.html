<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log in</title>
    <link
            rel="css/stylesheet"
            href="/assets/sweetalert/sweetalert2.min.css"
    />
    <link rel="stylesheet" href="/assets/css/login.css">
    <script src="https://kit.fontawesome.com/8195191d3d.js" crossorigin="anonymous"></script>
</head>
<body>
<div class="row" >
    <div class="col-md-6 mx-auto p-0">
        <form>
            <div class="card">
                <div class="login-box">
                    <div class="login-snip">
                        <input id="tab-1" type="radio" name="tab" class="sign-in" checked><label for="tab-1"
                                                                                                 class="tab">Login</label>
                        <input id="tab-2" type="radio" name="tab" class="sign-up"><label for="tab-2" class="tab">Sign
                        Up</label>
                        <div class="login-space">
                            <div class="login">
                                <div class="group">
                                    <label for="loginUName" class="label">Username</label>
                                    <input id="loginUName" name="username" type="text" class="input"
                                           placeholder="Enter your username">
                                </div>
                                <div class="group">
                                    <label for="loginUPassword" class="label">Password</label>
                                    <input id="loginUPassword" name="password" type="password" class="input"
                                           data-type="password" placeholder="Enter your password">
                                </div>
                                <div class="group">
                                    <input id="check" type="checkbox" class="check" checked>
                                    <label for="check"><span class="icon"></span> Keep me Signed in</label>
                                </div>
                                <div class="group">
                                    <input type="button" id="signInBtn" class="button" value="Sign In">
                                </div>
                                <div class="hr"></div>
                                <div class="foot">
                                    <a href="#">Forgot Password?</a>
                                </div>
                            </div>
                            <div class="sign-up-form">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="group">
                                            <label for="usernameRe" class="label">Username</label>
                                            <input id="usernameRe" name="username" type="text" class="input"
                                                   placeholder="Enter username">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="group">
                                            <label for="roleRe" class="label">Select role</label>
                                            <select class="form-select" id="roleRe">
                                                <option value="1">ADMIN</option>
                                                <option value="2">USER</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="group">
                                    <label for="passwordRe" class="label">Password</label>
                                    <input id="passwordRe" type="password" name="password" class="input"
                                           data-type="password"
                                           placeholder="Create your password">
                                </div>
                                <div class="group">
                                    <label for="re-password" class="label">Repeat Password</label>
                                    <input id="re-password" type="password" class="input" data-type="password"
                                           placeholder="Repeat your password">
                                </div>
                                <div class="group">
                                    <label for="emailRe" class="label">Email Address</label>
                                    <input id="emailRe" name="email" type="text" class="input"
                                           placeholder="Enter your email address">
                                </div>

                                <div class="group">
                                    <input type="button" id="signUpBtn" class="button" value="Sign Up">
                                </div>
                                <div class="hr"></div>
                                <div class="foot">
                                    <label for="tab-1">Already Member?</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <div class="toast-container" style="position: absolute; top: 0; right: 0;">

    </div>
</div>
<script
        src="https://code.jquery.com/jquery-3.6.3.min.js"
        integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU="
        crossorigin="anonymous"
></script>
<link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
        crossorigin="anonymous"
/>
<link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
        crossorigin="anonymous"
/>
<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"
></script>
<script src="/assets/jquery/jquery.validate.min.js"></script>
<script src="/assets/sweetalert/sweetalert2.all.min.js"></script>
<script src="/assets/js/baseapp.js"></script>
<script>
    let PORT = 8096;
    function login() {

        $("#signInBtn").on("click", () => {
            let loginUName = $("#loginUName").val();
            let loginPassword = $("#loginUPassword").val();
            let user = {username: loginUName, password: loginPassword}
            $.ajax({
                headers: {
                    accept: "application/json",
                    "content-type": "application/json"
                }, type: "POST",
                url: "http://localhost:"+PORT+"/users/login",
                data: JSON.stringify(user)
            }).done((data) => {
                window.location.href = "http://localhost:"+PORT+"/index"
            }).fail(() => {
                AppBase.SweetAlert.showErrorAlert("Customer not found")
            })
        })
    }

    function register() {
        $("#signUpBtn").on("click", () => {
            let username = $("#usernameRe").val();
            let roles = Array.from(new Set([{id: $("#roleRe").val()}]))
            let password = $("#passwordRe").val();
            let email = $("#emailRe").val();

            let user = {username, roles, password, email};

            $.ajax({
                headers: {
                    accept: "application/json",
                    "content-type": "application/json"
                },
                url: "http://localhost:"+PORT+"/users/register",
                type: "POST",
                data: JSON.stringify(user)
            }).done(() => {
                AppBase.SweetAlert.showSuccessAlert("New user is created successfully!")
            }).fail((jqXHR) => {
                let error = jqXHR.responseJSON;
                console.log(error)
                let toast = "";
                $.each(error, (k, v) => {
                    toast += `
                            <div class="toast border border-danger" role="alert" aria-live="assertive" aria-atomic="true">
                                <div class="toast-header">
                                    <strong class="me-auto text-danger">${k}</strong>
                                    <small class="text-muted">just now</small>
                                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                                </div>
                                <div class="toast-body">
                                   ${v}
                                </div>
                             </div>
                            `
                });
                $(".toast-container").empty().append(toast);
                $(".toast").toast({
                    animation: true,
                    autohide: true,
                    delay: 3000
                }).toast("show");
            })
        })
    }

    window.onload = () => {
        login();
        register();
    }
</script>
</body>
</html>